<!DOCTYPE html>

<!-- https://www.w3.org/TR/SVG/paths.html#PathData -->
<!-- https://www.w3.org/TR/SVG/text.html#TextLayoutPath -->
<html>
<head>
  <title>Garden.js</title>
  <script src="svg.js"></script>
</head>
<body>
	<div id="drawing"></div>

	<div id="root" style="display: none;">
		I struggle to
			<div>choose a direction for my work.</div>
			<div>deciding what to write each time I [pick up the pen / crack open my laptop]
				<div>I have too many things to say!</div>            
				<div>
					I realize that anything I have to say [has either]
					<div>has already been said (far more eloquently than I ever could)</div>
					<div>[or] lacks any real depth: my thoughts are fleeting, my ideas sometimes feel simple. I catch myself
						<div>ruminating on the 'length' of a thought: how many points do I really have to make? how far down have I thought this through? Is it worth even beginning?</div>
						<div>spiraling down through the chain of possible worlds, wondering if I'll pull a black stone that will collapse the waveform.
							<div>Because I know that once you commit a thought to the page, it dictates everything else that follows. Even if you cross it out, delete it.
								<div>It's still been there.</div>
								<div>You remember.</div>
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>

<script>

	let [xMod, yMod] = [1, 4];
	var draw = SVG('drawing').size(window.innerWidth, window.innerHeight);
	draw.viewbox(0, 0, 100, 100);
	// var line = draw.line(0, 0, 100, 100).stroke({ width: 1 })

	function drawBranch(string, start, angle) {
		console.log('start', start)
		var text = draw.text(function(add) { add.tspan(string); })
		text.on('mouseover', function () {this.attr({fill: 'red'})}.bind(text) );
		text.on('mouseout', function () {this.attr({fill: 'black'})}.bind(text) );
		var length = text.length() / 5.3; // TODO get this un-hardcodeds
		
		console.log('length', length, string);
		var end = [start[0] + length * Math.cos(angle), start[1] + length * Math.sin(angle)];
		var path = 'M ' + start[0].toString() + ' ' + start[1].toString() + ' T ' + end[0].toString() + ' ' + end[1].toString(); //+ ' M ' + end[0].toString() + ' ' + end[1].toString();
		text.path(path).font({size: 3})
		
		console.log('start', start, 'end', end)
		console.log('path', path);
		return end;
	}

	function drawForkingPaths(div, start, angle) {
		var end;

		if (div.firstChild) {
			let text = div.firstChild.data.trim();
			console.log(text);
			end = drawBranch(text, start, angle);
		} else {
			end = start;
		}

		// Recurse through children
		let children = div.childNodes;
		let directChildDivs = [];
		for(let child of children) {
			if (child.nodeName == 'DIV') {
				directChildDivs.push(child);
			}
		}
		const baseAngle = Math.PI / 16;
		let newAngle = - baseAngle;
		for(let child of directChildDivs) {
			drawForkingPaths(child, end, newAngle);
			newAngle += directChildDivs.length * baseAngle;
		}
	}

	var root = document.getElementById('root');
	var divs = root.getElementsByTagName('div');
	drawForkingPaths(root, [-38, 50], 0);

</script>


</body>
</html>